{% extends 'clipapp/login_nav.html' %}
{% block title %}Dashboard{% endblock %}
{% block content %}

    <main class="dashboard-container">
        <div class="search-bar">
            <span class="search-icon">üîç</span>
            <input type="text" placeholder="Search snippets...">
        </div>

        <div class="snippet-grid">
            <!-- Snippet cards will be dynamically populated here -->
        </div>
    </main>

    <footer class="footer">
        <div class="footer-container">
            <div class="footer-links">
                <a href="#">About</a>
                <a href="#">Contact</a>
                <a href="#">Privacy Policy</a>
            </div>
            <div class="copyright">
                ¬© 2024 ClipBuddy
            </div>
        </div>
    </footer>

    <script>
        // Mobile menu toggle
        const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
        const navLinks = document.querySelector('.nav-links');

        mobileMenuBtn.addEventListener('click', () => {
            navLinks.classList.toggle('active');
        });

        // Dark mode toggle
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
        }

        // Copy snippet functionality
        function copySnippet(content) {
            navigator.clipboard.writeText(content)
                .then(() => alert('Copied to clipboard!'))
                .catch(err => console.error('Failed to copy:', err));
        }

        // Function to render snippets
        function renderSnippets(snippetsArray) {
            const grid = document.querySelector('.snippet-grid');
            grid.innerHTML = snippetsArray.map(snippet => `
                <div class="snippet-card">
                    <div class="snippet-header">
                        <h3>${snippet.title}</h3>
                        <button class="btn-secondary" onclick="toggleFavorite(${snippet.id})">
                            ${snippet.favorite ? '‚≠ê' : '‚òÜ'}
                        </button>
                    </div>
                    <div class="snippet-content">
                        ${snippet.content}
                    </div>
                    <div class="snippet-tags">
                        ${snippet.tags.map(tag => `
                            <span class="tag">${tag}</span>
                        `).join('')}
                    </div>
                    <div class="snippet-actions">
                        <button class="btn btn-secondary" onclick="copySnippet('${snippet.content}')">
                            Copy
                        </button>
                        <button class="btn btn-primary" onclick="editSnippet(${snippet.id})">
                            Edit
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Fetch snippets from the API
        async function fetchSnippets() {
            try {
                const response = await fetch('/api/snippets/', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    }
                });
                if (response.ok) {
                    const snippets = await response.json();
                    renderSnippets(snippets);
                } else {
                    console.error('Failed to fetch snippets', response);
                }
            } catch (error) {
                console.error('Error fetching snippets', error);
            }
        }

        // Initial fetch and render snippets
        fetchSnippets();

        // Search functionality
        const searchInput = document.querySelector('.search-bar input');
        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const grid = document.querySelector('.snippet-grid');
            const allSnippets = grid.querySelectorAll('.snippet-card');
            allSnippets.forEach(snippet => {
                const title = snippet.querySelector('h3').textContent.toLowerCase();
                const content = snippet.querySelector('.snippet-content').textContent.toLowerCase();
                const tags = Array.from(snippet.querySelectorAll('.tag')).map(tag => tag.textContent.toLowerCase());
                const matches = title.includes(searchTerm) || content.includes(searchTerm) || tags.some(tag => tag.includes(searchTerm));
                snippet.style.display = matches ? 'block' : 'none';
            });
        });
    </script>
{% endblock %}
